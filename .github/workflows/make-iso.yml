name: Customize Windows 11 ISO with autounattend.xml

on:
  workflow_dispatch:

jobs:
  build-custom-iso:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install required tools
        run: |
          sudo apt-get update
          sudo apt-get install -y p7zip-full genisoimage

      - name: Extract original ISO
        run: |
          mkdir winiso
          7z x win11.iso -owiniso

      - name: Add autounattend.xml to ISO root
        run: |
          cp autounattend.xml winiso/

      - name: Rebuild ISO
        run: |
          genisoimage \
            -iso-level 4 \
            -udf \
            -b boot/etfsboot.com \
            -no-emul-boot \
            -boot-load-size 8 \
            -eltorito-alt-boot \
            -eltorito-platform efi \
            -b efi/microsoft/boot/efisys.bin \
            -no-emul-boot \
            -o win11-custom.iso \
            winiso

      - name: Upload custom ISO
        uses: actions/upload-artifact@v3
        with:
          name: win11-custom
          path: win11-custom.iso
